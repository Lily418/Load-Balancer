<!doctype html>
<html>
<head>
    <title>Socket.IO chat</title>
    <script src="http://178.62.27.130:3000/socket.io/socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="https://dl.dropboxusercontent.com/u/36831702/js/highcharts.js"></script>
    <script src="https://dl.dropboxusercontent.com/u/36831702/js/modules/exporting.js"></script>

    <script>
    $(function(){

        var socket = io.connect("178.62.27.130:3000");

        var series;
        var chart;
        $('#container').highcharts({
            chart: {
                type: 'spline',
                marginRight: 10,
                events: {
                    load: function () {
                        series = this.series[0];
                        chart = this;
                    }
                }
            },
            title: {
                text: 'CPU Usage'
            },

            yAxis: {
                title: {
                    text: 'Usage %'
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }],
                min: 0,
                max: 100,
            },
            xAxis: {
                title: {
                    text: 'Time'
                },
                type: 'datetime',
                tickPixelInterval: 100,
            },
            tooltip: {
                formatter: function () {
                    return '<b>' + this.series.name + '</b><br/>' +
                    Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) + '<br/>' +
                    Highcharts.numberFormat(this.y, 2);
                }
            },

            series: [{
                name: 'CPU Usage',
                data: (function () {
                    return [];
                }())
            }]
        })


        socket.on('cpu-usage', function(msg){
            console.log(msg)
            if(series !== undefined){
                series.addPoint([(new Date()).getTime(), parseFloat(msg)], true, false, true);
                var min = new Date().setMinutes(new Date().getMinutes() - 3);
                var max = new Date().setMinutes(new Date().getMinutes() + 1);
                chart.xAxis[0].setExtremes(min, max);

        } else {
            console.log('highchart undefined')
        }
    });

}
)

</script>
</head>
<body>
    <div id="container" style="min-width: 310px; height: 400px; margin: 0 auto"></div>

</body>
</body>
</html>
