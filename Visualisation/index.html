<!doctype html>
<html>
<head>
    <title>CPU Usage</title>
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="https://dl.dropboxusercontent.com/u/36831702/js/highcharts.js"></script>
    <script src="https://dl.dropboxusercontent.com/u/36831702/js/modules/exporting.js"></script>

    <script>
    $(function(){

        var socket = io.connect("http://192.168.56.113:3000");
        var chart;
        $('#container').highcharts({
            chart: {
                type: 'spline',
                marginRight: 10,
                events: {
                    load: function () {
                        chart = this;
                    }
                }
            },
            title: {
                text: 'CPU Usage'
            },

            yAxis: {
                title: {
                    text: 'Usage %'
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }],
                min: 0,
                max: 100,
            },
            xAxis: {
                title: {
                    text: 'Time'
                },
                type: 'datetime',
                tickPixelInterval: 100,
            },
            tooltip: {
                formatter: function () {
                    return '<b>' + this.series.name + '</b><br/>' +
                    Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) + '<br/>' +
                    Highcharts.numberFormat(this.y, 2);
                }
            }
        })


        socket.on('cpu-ip', function(msg){
            msg = JSON.parse(msg);

            if(chart === undefined){
                console.log('chart undefined');
                return;
            }

            var series = chart.get(msg.ip);

            if(series == null){
                chart.addSeries({
                    name: "Load for " + msg.ip,
                    id: msg.ip,
                    data: []
                });

                series = chart.get(msg.ip);
            }

            series.addPoint([(new Date()).getTime(), parseFloat(msg.usage)], true, false, true);


            var min = new Date().setMinutes(new Date().getMinutes() - 3);
            var max = new Date().setMinutes(new Date().getMinutes() + 1);
            chart.xAxis[0].setExtremes(min, max);


        });

    }
)

</script>
</head>
<body>
    <div id="container" style="min-width: 310px; height: 400px; margin: 0 auto"></div>

</body>
</body>
</html>
